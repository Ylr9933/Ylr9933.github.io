

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/Ylr9933/img/fluid.jpg">
  <link rel="icon" href="/Ylr9933/img/fluid.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="YLR">
  <meta name="keywords" content="">
  
    <meta name="description" content="计算机组成原理-课程设计-31指令CPU文章目录 1.前言 2.指令表 3.数据通路图 4.数据通路总图 5.控制部件设计 6.代码编写  1.前言本实验中我将使用Verilog HDL语言设计一个31条指令单周期的CPU设计，并完成前仿真、后仿真和下板调试运行。设计CPU是一项繁杂的任务，在此过程中，要明确每一步设计流程，才能减少Debug的时间（改bug怎的很费时间），提高效率。大致流程如下：">
<meta property="og:type" content="article">
<meta property="og:title" content="31指令CPU">
<meta property="og:url" content="https://github.com/Ylr9933/2024/07/26/CPU31/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="计算机组成原理-课程设计-31指令CPU文章目录 1.前言 2.指令表 3.数据通路图 4.数据通路总图 5.控制部件设计 6.代码编写  1.前言本实验中我将使用Verilog HDL语言设计一个31条指令单周期的CPU设计，并完成前仿真、后仿真和下板调试运行。设计CPU是一项繁杂的任务，在此过程中，要明确每一步设计流程，才能减少Debug的时间（改bug怎的很费时间），提高效率。大致流程如下：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/img/CPU31-image.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-1.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-2.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-3.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-4.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-5.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-6.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-7.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-8.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-9.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-10.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-11.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-12.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-13.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-14.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-15.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-16.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-17.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-18.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-19.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-20.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-21.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-22.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-23.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-24.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-25.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-26.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-27.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-28.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-29.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-30.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-31.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-32.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-33.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-34.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-35.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-36.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-37.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-38.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-39.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-40.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-41.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-42.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-43.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-44.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-45.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-46.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-47.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-48.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-49.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-50.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-51.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-52.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-53.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-54.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-55.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-56.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-57.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-58.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-59.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-60.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-61.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-62.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-63.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-64.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-65.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-66.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-67.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-68.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-69.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-70.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-71.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-72.png">
<meta property="og:image" content="https://github.com/img/CPU31-image-73.png">
<meta property="article:published_time" content="2024-07-26T09:45:17.000Z">
<meta property="article:modified_time" content="2024-07-27T03:47:31.698Z">
<meta property="article:author" content="YLR">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://github.com/img/CPU31-image.png">
  
  
  
  <title>31指令CPU - 个人博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/Ylr9933/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/Ylr9933/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/Ylr9933/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"github.com","root":"/Ylr9933/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/Ylr9933/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/Ylr9933/js/utils.js" ></script>
  <script  src="/Ylr9933/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/Ylr9933/">
      <strong>YLR</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Ylr9933/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Ylr9933/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Ylr9933/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Ylr9933/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Ylr9933/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/Ylr9933/img/background.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="31指令CPU"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-26 17:45" pubdate>
          2024年7月26日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          84 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">31指令CPU</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="计算机组成原理-课程设计-31指令CPU"><a href="#计算机组成原理-课程设计-31指令CPU" class="headerlink" title="计算机组成原理-课程设计-31指令CPU"></a>计算机组成原理-课程设计-31指令CPU</h1><h2 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h2><ul>
<li><a href="#1%E5%89%8D%E8%A8%80">1.前言</a></li>
<li><a href="#2%E6%8C%87%E4%BB%A4%E8%A1%A8">2.指令表</a></li>
<li><a href="#3%E6%95%B0%E6%8D%AE%E9%80%9A%E8%B7%AF%E5%9B%BE">3.数据通路图</a></li>
<li><a href="#4%E6%95%B0%E6%8D%AE%E9%80%9A%E8%B7%AF%E6%80%BB%E5%9B%BE">4.数据通路总图</a></li>
<li><a href="#5%E6%8E%A7%E5%88%B6%E9%83%A8%E4%BB%B6%E8%AE%BE%E8%AE%A1">5.控制部件设计</a></li>
<li><a href="#6%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99">6.代码编写</a></li>
</ul>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>本实验中我将使用Verilog HDL语言设计一个31条指令单周期的CPU设计，并完成前仿真、后仿真和下板调试运行。设计CPU是一项繁杂的任务，在此过程中，要明确每一步设计流程，才能减少Debug的时间（改bug怎的很费时间），提高效率。<br>大致流程如下：列出CPU指令表→绘制各个指令的数据流图→绘制数据流总图→列出指令信号表→编写代码实现CPU基础功能→测试→仿真下板</p>
<h2 id="2-指令表"><a href="#2-指令表" class="headerlink" title="2.指令表"></a>2.指令表</h2><p>31条指令表如下：<br><img src="/Ylr9933/../img/CPU31-image.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>其中的指令可以分为三类，分别是：</p>
<p>R-type:<br>OP为000000,由func来决定他的功能，主要用于操作寄存器之间的算术和逻辑运算。rs和rt是源寄存器，通常存操作数，rd是目标寄存器，通常存结果。shamt代表移位操作中的位移量，是立即数。</p>
<p>I-type:<br>I型指令都包含了一个立即数（常数），用于与常数相关的计算，观察表发现，I型指令将rd，shamt，func替换为了immediate，因此I型指令由op直接决定，rs作为源寄存器，rd作为目标寄存器。</p>
<p>J-type:<br>J型指令只有两条，用来实现无条件跳转。</p>
<h2 id="3-数据通路图"><a href="#3-数据通路图" class="headerlink" title="3.数据通路图"></a>3.数据通路图</h2><h3 id="R-type"><a href="#R-type" class="headerlink" title="R-type"></a>R-type</h3><p>1.ADD<br>格式：ADD rd,rs,rt<br>目的：与32位数相加。<br>描述：rd←rs+rt<br>将通用寄存器中存的32位数据rs与rt相加产生一个32位数据存入目标寄存器rd。<br>（1）如果发生了溢出，则rd不改变且产生一个溢出的异常<br>（2）如果相加不溢出，则产生的32位数据直接存入目标寄存器rd。<br>操作：rd←rs+rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A+B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-1.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-2.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>2.ADDU<br>格式：ADDU rd,rs,rt<br>目的：与32位数相加。<br>描述：rd←rs+rt<br>将通用寄存器中存的32位数据rs与rt相加产生一个32位数据存入目标寄存器rd。在任何情况下都不会有溢出的异常<br>操作：rd←rs+rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A+B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-3.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-4.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>3.SUB<br>格式：SUB rd,rs,rt<br>目的：与32位数相减。<br>描述：rd←rs-rt<br>将通用寄存器中存的32位数据rs与rt相减产生一个32位数据存入目标寄存器rd。<br>（1）如果发生了溢出，则rd不改变且产生一个溢出的异常<br>（2）如果相减不溢出，则产生的32位数据直接存入目标寄存器rd。<br>操作：rd←rs-rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A-B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-5.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-6.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>4.SUBU<br>格式：SUBU rd,rs,rt<br>目的：与32位数相减。<br>描述：rd←rs-rt<br>将通用寄存器中存的32位数据rs与rt相减产生一个32位数据存入目标寄存器rd。在任何情况下都不会有溢出的异常<br>操作：rd←rs-rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A-B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-7.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-8.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>5.AND<br>格式：AND rd,rs,rt<br>目的：按位逻辑与。<br>描述：rd←rs AND rt<br>将通用寄存器rs和rt中的数据每一位做按位与操作，将结果存入目标寄存器rd中。<br>操作：rd←rs AND rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A AND B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-9.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-10.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>6.OR<br>格式：OR rd,rs,rt<br>目的：按位逻辑或。<br>描述：rd←rs OR rt<br>将通用寄存器rs和rt中的数据每一位做按位或操作，将结果存入目标寄存器rd中。<br>操作：rd←rs OR rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A OR B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-11.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-12.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>7.XOR<br>格式：XOR rd,rs,rt<br>目的：按位逻辑异或。<br>描述：rd←rs XOR rt<br>将通用寄存器rs和rt中的数据每一位做按位异或操作，将结果存入目标寄存器rd中。<br>操作：rd←rs XOR rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A XOR B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-13.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-14.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>8.NOR<br>格式：NOR rd,rs,rt<br>目的：按位逻辑或非。<br>描述：rd←rs NOR rt<br>将通用寄存器rs和rt中的数据每一位做按位或非操作，将结果存入目标寄存器rd中。<br>操作：rd←rs NOR rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A NOR B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-15.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-16.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>9.SLT(set less than)<br>格式：SLT rd,rs,rt<br>目的：通过小于的比较来记录结果<br>描述：rd←(rs &lt; rt)<br>比较在rs和rt寄存器中保存的有符号数，用boolean值保存结果到rd寄存器中。如果rs小于rt，则结果为1，反之结果为0。算数比较不会引起溢出异常。<br>操作：rd←(rs &lt; rt),PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT1。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A - B→result)<br>SF→EXT1&#x2F;&#x2F;1位拓展到32位<br>EXT1_OUT→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-17.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-18.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>10.SLTU<br>格式：SLTU rd,rs,rt<br>目的：通过小于的比较来记录结果<br>描述：rd←(rs &lt; rt)<br>比较在rs和rt寄存器中保存的无符号数，用boolean值保存结果到rd寄存器中。如果rs小于rt，则结果为1，反之结果为0。算数比较不会引起溢出异常。<br>操作：rd←(rs &lt; rt),PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT1。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs→A,rt→B<br>(A - B→result)<br>SF→EXT1&#x2F;&#x2F;1位拓展到32位<br>EXT1_OUT→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-19.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-20.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>11.SLL(shift left logical)<br>格式：SLL rd,rt,sa<br>目的：通过数字0填充逻辑左移<br>描述：rd←rt&lt;&lt;sa<br>将通用寄存器rt的内容左移sa位，空余出来的位置用0来填充，把结果存入rd寄存器<br>操作：rd←rt&lt; &lt;sa,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[10:6]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &lt;&lt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-21.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-22.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>12.SRL(shift right logical)<br>格式：SRL rd,rt,sa<br>目的：通过数字0填充逻辑右移<br>描述：rd←rt&gt;&gt;sa<br>将通用寄存器rt的内容右移sa位，空余出来的位置用0来填充，把结果存入rd寄存器<br>操作：rd←rt&gt;&gt;sa,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[10:6]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &gt;&gt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-23.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-24.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>13.SRA(shift right arithmetic)<br>格式：SRA rd,rt,sa<br>目的：通过数字填充算术右移<br>描述：rd←rt&gt;&gt;sa<br>将通用寄存器rt的32位内容右移sa位，高位用rt[31]来填充，结果存入通用寄存器rd。<br>操作：rd←rt&gt;&gt;sa,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[10:6]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &gt;&gt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-25.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-26.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>14.SLLV(shift left logic variable)<br>格式：SLLV rd,rt,rs<br>目的：通过数字0填充逻辑左移<br>描述：rd←rt&lt;&lt;rs<br>将通用寄存器rt中的内容逻辑左移，左移的位数保存在rs寄存器中，空余出来的位置用0来填充，把结果存入rd寄存器。<br>操作：rd←rt&lt;&lt;rs,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs[4:0]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &lt;&lt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-27.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-28.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>15.SRLV(shift right logic variable)<br>格式：SRLV rd,rt,rs<br>目的：通过数字0填充逻辑右移<br>描述：rd←rt&gt;&gt;rs<br>将通用寄存器rt中的32位内容右移，高位用rt[31]来填充，结果存入通用寄存器rd。右移的位数由通用寄存器rs中的0~4bit确定<br>操作：rd←rt&gt;&gt;rs,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs[4:0]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &gt;&gt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-29.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-30.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>16.SRAV(shift right arithmetic variable)<br>格式：SRAV rd,rt,rs<br>目的：通过数字填充算术右移<br>描述：rd←rt&gt;&gt;rs<br>将通用寄存器rt中的32位内容右移，高位用rt[31]来填充，结果存入通用寄存器rd。右移的位数由通用寄存器rs中的0~4bit确定<br>操作：rd←rt&gt;&gt;rs,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>rs[4:0]→EXT5<br>EXT5_OUT→A<br>rt→B<br>(B &gt;&gt; A→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-31.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-32.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>17.JR(jump register)<br>格式：JR rs<br>目的：使用寄存器的跳转指令<br>描述：PC←rs<br>跳转地址存放在通用寄存器rs中，直接跳转到寄存器所存地址。<br>操作：rd←rt&gt;&gt;rs,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT5。<br>指令周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→MUX<br>rs→MUX&#x2F;&#x2F;多路选择器，选择rs的地址或NPC的地址<br>MUX_OUT→PC<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-33.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-34.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<h3 id="I-type"><a href="#I-type" class="headerlink" title="I-type"></a>I-type</h3><p>18.ADDI<br>格式：ADDI rd,rs,immediate<br>目的：使32位数据与一个立即数相加<br>描述：rd←rs+immediate<br>一个16位有符号的立即数与通用寄存器rs中的32位数相加产生一个32位的数存入目标寄存器rd。<br>（1）如果发生了溢出，则rd不改变且产生一个溢出的异常<br>（2）如果相加不溢出，则结果存入目标寄存器rd。<br>操作：rd←rs+immediate,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A+B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-35.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-36.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>19.ADDIU<br>格式：ADDIU rd,rs,immediate<br>目的：使32位数据与一个立即数相加<br>描述：rd←rs+immediate<br>一个16位有符号的立即数与通用寄存器rs中的32位数相加产生一个32位的数存入目标寄存器rd。<br>在任何情况下都不会有溢出的异常<br>操作：rd←rs+immediate,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A+B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-37.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-38.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>20.ANDI<br>格式：ANDI,rd,rs,immediate<br>目的：与一个常数做按位逻辑与。<br>描述：rd←rs AND immediate<br>将16位立即数做0扩展后与通用寄存器rs中的32位数据做按位与，将结果存入目标寄存器rd<br>操作：rd←rs ANDI immediate,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A&amp;B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-39.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-40.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>21.ORI<br>格式：ORI,rd,rs,immediate<br>目的：与一个常数做按位逻辑或。<br>描述：rd←rs ORI immediate<br>将16位立即数做0扩展后与通用寄存器rs中的32位数据做按位或，将结果存入目标寄存器rd<br>操作：rd←rs ORI immediate,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A|B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-41.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-42.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>22.XORI<br>格式：ORI,rd,rs,immediate<br>目的：与一个常数做按位逻辑异或。<br>描述：rd←rs XORI immediate<br>将16位立即数做0扩展后与通用寄存器rs中的32位数据做按位异或，将结果存入目标寄存器rd<br>操作：rd←rs XORI immediate,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A^B→result)<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-43.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-44.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>23.LW(Load Word)<br>格式：LW rd,offset(base)<br>目的：从内存读取一个字的有符号数据。<br>描述：rd←memory[base + offset]<br>从内存中基地址加偏移量所得到的准确地址中的内容加载到通用寄存器rd中。<br>操作：rd←memory[base + offset],PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A + B→result)<br>result→DMEM_ADDR<br>DMEM_OUT→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-45.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-46.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>24.SW(Store Word)<br>格式：SW rt,offset(base)<br>目的：存一个字到内存。<br>描述：memory[base + offset]←rt<br>将通用寄存器rt中的32位数据存入内存中的有效地址，有效地址由基地址和16位偏移量相加所得。<br>操作：memory[base + offset]←rt,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A + B→result)<br>Rt→DMEM<br>result→DMEM_ADDR<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-47.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-48.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>25.BEQ(Branch if Equal)<br>格式：BEQ rs,rt,offset<br>目的：比较通用寄存器的值，然后做PC相关的分支跳转<br>描述：如果rs&#x3D;rt，那么将offset左移两位（乘以4，因为每条指令的长度是4字节），再进行符号扩展到32位与当前pc相加，形成有效转移地址，转到该地址<br>如果rs!&#x3D;rt，则继续执行下条指令。<br>操作：将rs与rt相减，若结果为0则跳转，否则不跳转。<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT18、MUX。<br>指令周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→MUX<br>IMEM[15:0]||02→EXT18<br>EXT18_OUT→ADD_A<br>NPC→ADD_B<br>(ADD_A+ADD_B→ADD_OUT)<br>ADD_OUT→MUX<br>rs→A<br>rt→B<br>(A-B→result)<br>Z→MUX<br>MUX→PC<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-49.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-50.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>26.BNE(Branch if not Equal)<br>格式：BNE rs,rt,offset<br>目的：比较通用寄存器的值，然后做PC相关的分支跳转<br>描述：如果rs!&#x3D;rt，那么将offset左移两位（乘以4，因为每条指令的长度是4字节），再进行符号扩展到32位与当前pc相加，形成有效转移地址，转到该地址<br>如果rs&#x3D;rt，则继续执行下条指令。<br>操作：将rs与rt相减，若结果不为0则跳转，否则不跳转。<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT18、MUX。<br>指令周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→MUX<br>IMEM[15:0]||02→EXT18<br>EXT18_OUT→ADD_A<br>NPC→ADD_B<br>(ADD_A+ADD_B→ADD_OUT)<br>ADD_OUT→MUX<br>rs→A<br>rt→B<br>(A-B→result)<br>Z→MUX<br>MUX→PC<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-51.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-52.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>27.SLTI(Set on Less Than Immediate)<br>格式：SLTI rd,rs,rt<br>目的：比通过跟立即数小于的比较来记录结果。<br>描述：rd←(rs &lt; rt)<br>比较在rs和rt寄存器中保存的有符号数，用boolean值保存结果到rd寄存器中。如过rs小于rt，则结果为1，反之结果为0,。算术比较不会引起溢出异常。<br>操作：rd←(rs &lt; rt),PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT1。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A-B→result)<br>CF→EXT1<br>EXT1_OUT→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-53.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-54.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>28.SLTIU<br>格式：SLTIU rd,rs,rt<br>目的：比通过跟立即数无符号小于的比较来记录结果。<br>描述：rd←(rs &lt; rt)<br>比较在rs和rt寄存器中保存的无符号数，用boolean值保存结果到rd寄存器中。如过rs小于rt，则结果为1，反之结果为0,。算术比较不会引起溢出异常。<br>操作：rd←(rs &lt; rt),PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT1。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>rs→A<br>(A-B→result)<br>CF→EXT1<br>EXT1_OUT→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-55.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-56.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>29.LUI(Load unsigned Immediate)<br>格式：LUI rt,immediate<br>目的：把一个立即数载入到寄存器的高位，低位补0.<br>描述：rt←immediate||016<br>将一个16位的立即数载入到通用寄存器rt的高位，低16位补0。<br>操作：rt←immediate||016,PC←NPC(PC+4)<br>所需部件：PC、NPC、IMEM、Regfile、ALU、EXT16。<br>指令周期：<br>·取指周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→PC<br>·执行周期：<br>IMEM[15:0]→EXT16<br>EXT16_OUT→B<br>result→rd<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-57.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-58.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<h3 id="J-type"><a href="#J-type" class="headerlink" title="J-type"></a>J-type</h3><p>30.J(Jump)<br>格式：J target<br>目的：在256MB的范围内跳转。<br>描述：该指令无条件跳转到一个绝对地址，instr_index有26位，在左移后访问空间能达到228B,即256MB。<br>操作：PC←NPC(target)<br>所需部件：PC、NPC、IMEM、MUX、||。<br>指令周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→MUX<br><br>PC[31:28]→||_A<br>IMEM[25:0]||02→||_B<br>IMEM[15:0]→EXT16<br>||_OUT→MUX<br><br>MUX_OUT→PC<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-59.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-60.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>31.JAL(Jump)<br>格式：JAL target<br>目的：在256MB的范围内执行一个过程调用。<br>描述：在跳转到知道地址执行子程序调用的同时，在31号寄存器中存放返回地址（当前地址后的第二条指令地址）<br>操作：rd←NPC(PC+8),PC←NPC(target)<br>所需部件：PC、NPC、IMEM、MUX、||、Regfile、ALU。<br>指令周期：<br>PC→IMEM<br>PC+4→NPC<br>NPC→MUX<br><br>8→A<br>PC→B<br>(A+B→result)<br>result→rd<br><br>PC[31:28]→||_A<br>IMEM[25:0]||02→||_B<br>IMEM[15:0]→EXT16<br>||_OUT→MUX<br><br>MUX_OUT→PC<br>指令流程图：<br><img src="/Ylr9933/../img/CPU31-image-61.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>数据通路图：<br><img src="/Ylr9933/../img/CPU31-image-62.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<h2 id="4-数据通路总图"><a href="#4-数据通路总图" class="headerlink" title="4.数据通路总图"></a>4.数据通路总图</h2><p>接下来，将上述31条指令的数据通路图合在一起，形成数据通路总图</p>
<p><img src="/Ylr9933/../img/CPU31-image-63.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<p>注意，在绘制数据通路总图时，要按照指令顺序依次画，最好同类型指令用同样的颜色标识，方便后期查错。</p>
<h2 id="5-控制部件设计"><a href="#5-控制部件设计" class="headerlink" title="5.控制部件设计"></a>5.控制部件设计</h2><p>将每条指令对应的所有控制信号列出，有了数据通路图，指令表就非常好写了。我们需要做的是在表中列出每一条指令和图中涉及到的所有操作信号，根据你列出的<br>通路图和每条指令涉及到的操作，将每条指令对应的操作信号标注出来。<br><img src="/Ylr9933/../img/CPU31-image-64.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>这部分内容对应的是control.v中的代码。</p>
<h2 id="6-代码编写"><a href="#6-代码编写" class="headerlink" title="6.代码编写"></a>6.代码编写</h2><h3 id="控制器Controler"><a href="#控制器Controler" class="headerlink" title="控制器Controler"></a>控制器Controler</h3><p>用于控制运行指令时每个元件的状态。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 控制器 */</span><br><span class="hljs-keyword">module</span> Controler(              <span class="hljs-comment">//根据当前要执行的指令输出各个元器件的状态</span><br>    <span class="hljs-keyword">input</span> add_flag,            <span class="hljs-comment">//指令是否为ADD</span><br>    <span class="hljs-keyword">input</span> addu_flag,           <span class="hljs-comment">//指令是否为ADDU</span><br>    <span class="hljs-keyword">input</span> sub_flag,            <span class="hljs-comment">//指令是否为SUB</span><br>    <span class="hljs-keyword">input</span> subu_flag,           <span class="hljs-comment">//指令是否为SUBU</span><br>    <span class="hljs-keyword">input</span> and_flag,            <span class="hljs-comment">//指令是否为AND</span><br>    <span class="hljs-keyword">input</span> or_flag,             <span class="hljs-comment">//指令是否为OR</span><br>    <span class="hljs-keyword">input</span> xor_flag,            <span class="hljs-comment">//指令是否为XOR</span><br>    <span class="hljs-keyword">input</span> nor_flag,            <span class="hljs-comment">//指令是否为NOR</span><br>    <span class="hljs-keyword">input</span> slt_flag,            <span class="hljs-comment">//指令是否为SLT</span><br>    <span class="hljs-keyword">input</span> sltu_flag,           <span class="hljs-comment">//指令是否为SLTU</span><br>    <span class="hljs-keyword">input</span> sll_flag,            <span class="hljs-comment">//指令是否为SLL</span><br>    <span class="hljs-keyword">input</span> srl_flag,            <span class="hljs-comment">//指令是否为SRL</span><br>    <span class="hljs-keyword">input</span> sra_flag,            <span class="hljs-comment">//指令是否为SRA</span><br>    <span class="hljs-keyword">input</span> sllv_flag,           <span class="hljs-comment">//指令是否为SLLV</span><br>    <span class="hljs-keyword">input</span> srlv_flag,           <span class="hljs-comment">//指令是否为SRLV</span><br>    <span class="hljs-keyword">input</span> srav_flag,           <span class="hljs-comment">//指令是否为SRAV</span><br>    <span class="hljs-keyword">input</span> jr_flag,             <span class="hljs-comment">//指令是否为JR</span><br>    <span class="hljs-keyword">input</span> addi_flag,           <span class="hljs-comment">//指令是否为ADDI</span><br>    <span class="hljs-keyword">input</span> addiu_flag,          <span class="hljs-comment">//指令是否为ADDIU</span><br>    <span class="hljs-keyword">input</span> andi_flag,           <span class="hljs-comment">//指令是否为ANDI</span><br>    <span class="hljs-keyword">input</span> ori_flag,            <span class="hljs-comment">//指令是否为ORI</span><br>    <span class="hljs-keyword">input</span> xori_flag,           <span class="hljs-comment">//指令是否为XORI</span><br>    <span class="hljs-keyword">input</span> lw_flag,             <span class="hljs-comment">//指令是否为LW</span><br>    <span class="hljs-keyword">input</span> sw_flag,             <span class="hljs-comment">//指令是否为SW</span><br>    <span class="hljs-keyword">input</span> beq_flag,            <span class="hljs-comment">//指令是否为BEQ</span><br>    <span class="hljs-keyword">input</span> bne_flag,            <span class="hljs-comment">//指令是否为BNE</span><br>    <span class="hljs-keyword">input</span> slti_flag,           <span class="hljs-comment">//指令是否为SLTI</span><br>    <span class="hljs-keyword">input</span> sltiu_flag,          <span class="hljs-comment">//指令是否为SLTIU</span><br>    <span class="hljs-keyword">input</span> lui_flag,            <span class="hljs-comment">//指令是否为LUI</span><br>    <span class="hljs-keyword">input</span> j_flag,              <span class="hljs-comment">//指令是否为J</span><br>    <span class="hljs-keyword">input</span> jal_flag,            <span class="hljs-comment">//指令是否为JAL</span><br>    <span class="hljs-keyword">input</span> zero,                <span class="hljs-comment">//ALU标志位ZF</span><br>    <span class="hljs-comment">/* 所有用到的元件和指令这里都会涉及到 */</span><br>    <span class="hljs-keyword">output</span> reg_w,              <span class="hljs-comment">//RegFile寄存器堆是否可写入</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] aluc,         <span class="hljs-comment">//ALUC的指令，决定ALUC执行何种操作</span><br>    <span class="hljs-keyword">output</span> dm_r,               <span class="hljs-comment">//DMEM是否可写入</span><br>    <span class="hljs-keyword">output</span> dm_w,               <span class="hljs-comment">//是否从DMEM中读取数据</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] ext_ena,      <span class="hljs-comment">//EXT扩展是否开启，5个状态分别对应EXT1、EXT5、EXT16、EXT16(S)、EXT18(S),其中EXT[0]对应EXT1</span><br>    <span class="hljs-keyword">output</span> cat_ena,            <span class="hljs-comment">//是否需要拼接</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">10</span>:<span class="hljs-number">0</span>] mux           <span class="hljs-comment">//10个多路选择器的状态（选择0还是选择1）(0没用到，为了使MUX编号和数组下标对应所以多一个)</span><br>    );<br><span class="hljs-comment">/* 下面是赋值，也就是根据要执行的操作决定各元器件的状态 */</span><br><span class="hljs-keyword">assign</span> reg_w = (!jr_flag &amp;&amp; !sw_flag &amp;&amp; !beq_flag &amp;&amp; !bne_flag &amp;&amp; !j_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> aluc[<span class="hljs-number">3</span>] = (slt_flag  || sltu_flag  || sllv_flag || srlv_flag ||<br>                  srav_flag || sll_flag   || srl_flag  || sra_flag  || <br>                  slti_flag || sltiu_flag || lui_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> aluc[<span class="hljs-number">2</span>] = (and_flag  || or_flag    || xor_flag  || nor_flag  ||<br>                  sllv_flag || srlv_flag  || srav_flag || sll_flag  ||<br>                  srl_flag  || sra_flag   || andi_flag || ori_flag  ||<br>                  xori_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> aluc[<span class="hljs-number">1</span>] = (add_flag  || sub_flag   || xor_flag  || nor_flag  ||<br>                  slt_flag  || sltu_flag  || sllv_flag || sll_flag  ||<br>                  addi_flag || xori_flag  || slti_flag || sltiu_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> aluc[<span class="hljs-number">0</span>] = (sub_flag  || subu_flag  || or_flag   || nor_flag  ||<br>                  slt_flag  || sllv_flag  || srlv_flag || sll_flag  ||<br>                  srl_flag  || ori_flag   || slti_flag || lui_flag  ||<br>                  beq_flag  || bne_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-comment">//aluc[0]中SLLV、SLL、LUI加不加均可</span><br><br><span class="hljs-keyword">assign</span> dm_r = lw_flag ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> dm_w = sw_flag ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> ext_ena[<span class="hljs-number">4</span>] = (beq_flag  || bne_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;                              <span class="hljs-comment">//EXT18(S)</span><br><span class="hljs-keyword">assign</span> ext_ena[<span class="hljs-number">3</span>] = (addi_flag || addiu_flag || lw_flag   || sw_flag ||<br>                     slti_flag || sltiu_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;                            <span class="hljs-comment">//EXT16(S)</span><br><span class="hljs-keyword">assign</span> ext_ena[<span class="hljs-number">2</span>] = (andi_flag || ori_flag   || xori_flag || lui_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;   <span class="hljs-comment">//EXT16</span><br><span class="hljs-keyword">assign</span> ext_ena[<span class="hljs-number">1</span>] = (sll_flag  || srl_flag   || sra_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;                <span class="hljs-comment">//EXT5</span><br><span class="hljs-keyword">assign</span> ext_ena[<span class="hljs-number">0</span>] = (slt_flag  || sltu_flag  || slti_flag || sltiu_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>; <span class="hljs-comment">//EXT1</span><br><br><span class="hljs-keyword">assign</span> cat_ena = (j_flag || jal_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">10</span>]= (sll_flag   || srl_flag   || sra_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">9</span>] = (add_flag   || addu_flag  || sub_flag  || subu_flag  ||<br>                 and_flag   || or_flag    || xor_flag  || nor_flag   ||<br>                 sll_flag   || srl_flag   || sra_flag  || sllv_flag  ||<br>                 srlv_flag  || srav_flag  || lui_flag  || addi_flag  || <br>                 addiu_flag || andi_flag  || ori_flag  || xori_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">8</span>] = (addi_flag  || addiu_flag || lw_flag   || sw_flag    ||<br>                 slti_flag  || sltiu_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">7</span>] = jal_flag ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">6</span>] = beq_flag ? ~zero : (bne_flag ? zero : <span class="hljs-number">1&#x27;b1</span>);<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">5</span>] = (addi_flag  || addiu_flag || andi_flag || ori_flag  ||<br>                 xori_flag  || lw_flag    || sw_flag   || slti_flag ||<br>                 sltiu_flag || lui_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">4</span>] = (!jr_flag &amp;&amp; !j_flag &amp;&amp; !jal_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">3</span>] = (sll_flag   || srl_flag   || sra_flag || sllv_flag || srlv_flag || srav_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">2</span>] = !lw_flag ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> mux[<span class="hljs-number">1</span>] = (j_flag || jal_flag) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="译码器Decoder"><a href="#译码器Decoder" class="headerlink" title="译码器Decoder"></a>译码器Decoder</h3><p>将指令码转化为控制信号输出。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 译码器 */</span><br><span class="hljs-keyword">module</span> Decoder(                 <span class="hljs-comment">//所有接口如果当前译码出的指令不需要，置为高阻抗</span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] instr_in,     <span class="hljs-comment">//需要译码的指令，也就是当前要执行的指令</span><br>    <span class="hljs-keyword">output</span> add_flag,            <span class="hljs-comment">//指令是否为ADD</span><br>    <span class="hljs-keyword">output</span> addu_flag,           <span class="hljs-comment">//指令是否为ADDU</span><br>    <span class="hljs-keyword">output</span> sub_flag,            <span class="hljs-comment">//指令是否为SUB</span><br>    <span class="hljs-keyword">output</span> subu_flag,           <span class="hljs-comment">//指令是否为SUBU</span><br>    <span class="hljs-keyword">output</span> and_flag,            <span class="hljs-comment">//指令是否为AND</span><br>    <span class="hljs-keyword">output</span> or_flag,             <span class="hljs-comment">//指令是否为OR</span><br>    <span class="hljs-keyword">output</span> xor_flag,            <span class="hljs-comment">//指令是否为XOR</span><br>    <span class="hljs-keyword">output</span> nor_flag,            <span class="hljs-comment">//指令是否为NOR</span><br>    <span class="hljs-keyword">output</span> slt_flag,            <span class="hljs-comment">//指令是否为SLT</span><br>    <span class="hljs-keyword">output</span> sltu_flag,           <span class="hljs-comment">//指令是否为SLTU</span><br>    <span class="hljs-keyword">output</span> sll_flag,            <span class="hljs-comment">//指令是否为SLL</span><br>    <span class="hljs-keyword">output</span> srl_flag,            <span class="hljs-comment">//指令是否为SRL</span><br>    <span class="hljs-keyword">output</span> sra_flag,            <span class="hljs-comment">//指令是否为SRA</span><br>    <span class="hljs-keyword">output</span> sllv_flag,           <span class="hljs-comment">//指令是否为SLLV</span><br>    <span class="hljs-keyword">output</span> srlv_flag,           <span class="hljs-comment">//指令是否为SRLV</span><br>    <span class="hljs-keyword">output</span> srav_flag,           <span class="hljs-comment">//指令是否为SRAV</span><br>    <span class="hljs-keyword">output</span> jr_flag,             <span class="hljs-comment">//指令是否为JR</span><br>    <span class="hljs-keyword">output</span> addi_flag,           <span class="hljs-comment">//指令是否为ADDI</span><br>    <span class="hljs-keyword">output</span> addiu_flag,          <span class="hljs-comment">//指令是否为ADDIU</span><br>    <span class="hljs-keyword">output</span> andi_flag,           <span class="hljs-comment">//指令是否为ANDI</span><br>    <span class="hljs-keyword">output</span> ori_flag,            <span class="hljs-comment">//指令是否为ORI</span><br>    <span class="hljs-keyword">output</span> xori_flag,           <span class="hljs-comment">//指令是否为XORI</span><br>    <span class="hljs-keyword">output</span> lw_flag,             <span class="hljs-comment">//指令是否为LW</span><br>    <span class="hljs-keyword">output</span> sw_flag,             <span class="hljs-comment">//指令是否为SW</span><br>    <span class="hljs-keyword">output</span> beq_flag,            <span class="hljs-comment">//指令是否为BEQ</span><br>    <span class="hljs-keyword">output</span> bne_flag,            <span class="hljs-comment">//指令是否为BNE</span><br>    <span class="hljs-keyword">output</span> slti_flag,           <span class="hljs-comment">//指令是否为SLTI</span><br>    <span class="hljs-keyword">output</span> sltiu_flag,          <span class="hljs-comment">//指令是否为SLTIU</span><br>    <span class="hljs-keyword">output</span> lui_flag,            <span class="hljs-comment">//指令是否为LUI</span><br>    <span class="hljs-keyword">output</span> j_flag,              <span class="hljs-comment">//指令是否为J</span><br>    <span class="hljs-keyword">output</span> jal_flag,            <span class="hljs-comment">//指令是否为JAL</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>]  RsC,          <span class="hljs-comment">//Rs对应的寄存器的地址</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>]  RtC,          <span class="hljs-comment">//Rt对应的寄存器的地址</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>]  RdC,          <span class="hljs-comment">//Rd对应的寄存器的地址</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>]  shamt,        <span class="hljs-comment">//位移偏移量（SLL，SRL，SRA用）</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] immediate,    <span class="hljs-comment">//立即数（I型指令用）</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] address       <span class="hljs-comment">//跳转地址（J型指令用）</span><br>    );<br><span class="hljs-comment">/* 定义各指令在原指令中对应的编码 */</span><br><span class="hljs-comment">/* 下面这些指令经过了扩展，OP段全为0，需要额外的6位FUNC加以区分 */</span><br><span class="hljs-keyword">parameter</span> ADD_OPE   = <span class="hljs-number">6&#x27;b100000</span>;<br><span class="hljs-keyword">parameter</span> ADDU_OPE  = <span class="hljs-number">6&#x27;b100001</span>;<br><span class="hljs-keyword">parameter</span> SUB_OPE   = <span class="hljs-number">6&#x27;b100010</span>;<br><span class="hljs-keyword">parameter</span> SUBU_OPE  = <span class="hljs-number">6&#x27;b100011</span>;<br><span class="hljs-keyword">parameter</span> AND_OPE   = <span class="hljs-number">6&#x27;b100100</span>;<br><span class="hljs-keyword">parameter</span> OR_OPE    = <span class="hljs-number">6&#x27;b100101</span>;<br><span class="hljs-keyword">parameter</span> XOR_OPE   = <span class="hljs-number">6&#x27;b100110</span>;<br><span class="hljs-keyword">parameter</span> NOR_OPE   = <span class="hljs-number">6&#x27;b100111</span>;<br><span class="hljs-keyword">parameter</span> SLT_OPE   = <span class="hljs-number">6&#x27;b101010</span>;<br><span class="hljs-keyword">parameter</span> SLTU_OPE  = <span class="hljs-number">6&#x27;b101011</span>;<br><br><span class="hljs-keyword">parameter</span> SLL_OPE   = <span class="hljs-number">6&#x27;b000000</span>;<br><span class="hljs-keyword">parameter</span> SRL_OPE   = <span class="hljs-number">6&#x27;b000010</span>;<br><span class="hljs-keyword">parameter</span> SRA_OPE   = <span class="hljs-number">6&#x27;b000011</span>;<br><br><span class="hljs-keyword">parameter</span> SLLV_OPE  = <span class="hljs-number">6&#x27;b000100</span>;<br><span class="hljs-keyword">parameter</span> SRLV_OPE  = <span class="hljs-number">6&#x27;b000110</span>;<br><span class="hljs-keyword">parameter</span> SRAV_OPE  = <span class="hljs-number">6&#x27;b000111</span>;<br><br><span class="hljs-keyword">parameter</span> JR_OPE    = <span class="hljs-number">6&#x27;b001000</span>;<br><span class="hljs-comment">/* 下面这些指令通过OP段直接加以区分 */</span><br><span class="hljs-keyword">parameter</span> ADDI_OPE  = <span class="hljs-number">6&#x27;b001000</span>;<br><span class="hljs-keyword">parameter</span> ADDIU_OPE = <span class="hljs-number">6&#x27;b001001</span>;<br><span class="hljs-keyword">parameter</span> ANDI_OPE  = <span class="hljs-number">6&#x27;b001100</span>;<br><span class="hljs-keyword">parameter</span> ORI_OPE   = <span class="hljs-number">6&#x27;b001101</span>;<br><span class="hljs-keyword">parameter</span> XORI_OPE  = <span class="hljs-number">6&#x27;b001110</span>;<br><span class="hljs-keyword">parameter</span> LW_OPE    = <span class="hljs-number">6&#x27;b100011</span>;<br><span class="hljs-keyword">parameter</span> SW_OPE    = <span class="hljs-number">6&#x27;b101011</span>;<br><span class="hljs-keyword">parameter</span> BEQ_OPE   = <span class="hljs-number">6&#x27;b000100</span>;<br><span class="hljs-keyword">parameter</span> BNE_OPE   = <span class="hljs-number">6&#x27;b000101</span>;<br><span class="hljs-keyword">parameter</span> SLTI_OPE  = <span class="hljs-number">6&#x27;b001010</span>;<br><span class="hljs-keyword">parameter</span> SLTIU_OPE = <span class="hljs-number">6&#x27;b001011</span>;<br><br><span class="hljs-keyword">parameter</span> LUI_OPE   = <span class="hljs-number">6&#x27;b001111</span>;<br><br><span class="hljs-keyword">parameter</span> J_OPE     = <span class="hljs-number">6&#x27;b000010</span>;<br><span class="hljs-keyword">parameter</span> JAL_OPE   = <span class="hljs-number">6&#x27;b000011</span>;<br><br><span class="hljs-comment">/* 下面是赋值 */</span><br><span class="hljs-comment">/* 对指令进行译码，判断是哪个指令 */</span><br><span class="hljs-keyword">assign</span> add_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == ADD_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> addu_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == ADDU_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> sub_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SUB_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> subu_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SUBU_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> and_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == AND_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> or_flag   = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == OR_OPE  )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> xor_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == XOR_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> nor_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == NOR_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> slt_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SLT_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> sltu_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SLTU_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> sll_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SLL_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> srl_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SRL_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> sra_flag  = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SRA_OPE )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> sllv_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SLLV_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> srlv_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SRLV_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> srav_flag = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == SRAV_OPE)) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> jr_flag   = ((instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == <span class="hljs-number">6&#x27;h0</span>) &amp;&amp; (instr_in[<span class="hljs-number">5</span>:<span class="hljs-number">0</span>] == JR_OPE  )) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> addi_flag  = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == ADDI_OPE ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> addiu_flag = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == ADDIU_OPE) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> andi_flag  = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == ANDI_OPE ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> ori_flag   = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == ORI_OPE  ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> xori_flag  = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == XORI_OPE ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> lw_flag    = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == LW_OPE   ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> sw_flag    = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == SW_OPE   ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> beq_flag   = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == BEQ_OPE  ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> bne_flag   = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == BNE_OPE  ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> slti_flag  = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == SLTI_OPE ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> sltiu_flag = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == SLTIU_OPE) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> lui_flag   = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == LUI_OPE  ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-keyword">assign</span> j_flag     = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == J_OPE    ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> jal_flag   = (instr_in[<span class="hljs-number">31</span>:<span class="hljs-number">26</span>] == JAL_OPE  ) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><br><span class="hljs-comment">/* 取出指令中各部分的值 */</span><br><span class="hljs-keyword">assign</span> RsC = (add_flag  || addu_flag || sub_flag  || subu_flag  ||<br>              and_flag  || or_flag   || xor_flag  || nor_flag   ||<br>              slt_flag  || sltu_flag || sllv_flag || srlv_flag  ||<br>              srav_flag || jr_flag   || addi_flag || addiu_flag ||<br>              andi_flag || ori_flag  || xori_flag || lw_flag    ||<br>              sw_flag   || beq_flag  || bne_flag  || slti_flag  ||<br>              sltiu_flag) ? instr_in[<span class="hljs-number">25</span>:<span class="hljs-number">21</span>] : <span class="hljs-number">5&#x27;hz</span>;<br><br><span class="hljs-keyword">assign</span> RtC = (add_flag  || addu_flag  || sub_flag   || subu_flag ||<br>              and_flag  || or_flag    || xor_flag   || nor_flag  ||<br>              slt_flag  || sltu_flag  || sll_flag   || srl_flag  ||<br>              sra_flag  || sllv_flag  || srlv_flag  || srav_flag ||<br>              sw_flag   || beq_flag   || bne_flag ) ? instr_in[<span class="hljs-number">20</span>:<span class="hljs-number">16</span>] : <span class="hljs-number">5&#x27;hz</span>;<br><br><span class="hljs-keyword">assign</span> RdC = (add_flag  || addu_flag  || sub_flag  || subu_flag  ||<br>              and_flag  || or_flag    || xor_flag  || nor_flag   ||<br>              slt_flag  || sltu_flag  || sll_flag  || srl_flag   ||<br>              sra_flag  || sllv_flag  || srlv_flag || srav_flag) ? instr_in[<span class="hljs-number">15</span>:<span class="hljs-number">11</span>] : ((<br>              addi_flag || addiu_flag || andi_flag || ori_flag   || <br>              xori_flag || lw_flag    || slti_flag || sltiu_flag ||<br>              lui_flag) ? instr_in[<span class="hljs-number">20</span>:<span class="hljs-number">16</span>] : (jal_flag ? <span class="hljs-number">5&#x27;d31</span> : <span class="hljs-number">5&#x27;hz</span>));<br><br><span class="hljs-keyword">assign</span> shamt = (sll_flag || srl_flag || sra_flag) ? instr_in[<span class="hljs-number">10</span>:<span class="hljs-number">6</span>] : <span class="hljs-number">5&#x27;hz</span>;        <br><br><span class="hljs-keyword">assign</span> immediate = (addi_flag || addiu_flag || andi_flag  || ori_flag || <br>                    xori_flag || lw_flag    || sw_flag    || beq_flag || <br>                    bne_flag  || slti_flag  || sltiu_flag || lui_flag) ? instr_in[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] : <span class="hljs-number">16&#x27;hz</span>;<br><br><span class="hljs-keyword">assign</span> address = (j_flag || jal_flag) ? instr_in[<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] : <span class="hljs-number">26&#x27;hz</span>;     <br><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="算术逻辑单元ALU"><a href="#算术逻辑单元ALU" class="headerlink" title="算术逻辑单元ALU"></a>算术逻辑单元ALU</h3><p>完成各种算术和逻辑运算</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 算术逻辑单元 */</span><br><span class="hljs-keyword">module</span> ALU(<br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] ALU_C,          <span class="hljs-comment">//操作指令</span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] A,             <span class="hljs-comment">//接口A</span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] B,             <span class="hljs-comment">//接口B</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] OUT,           <span class="hljs-comment">//运算结果</span><br>    <span class="hljs-comment">/* 运算标志位 */</span><br>    <span class="hljs-keyword">output</span> CF,<br>    <span class="hljs-keyword">output</span> ZF,<br>    <span class="hljs-keyword">output</span> SF,<br>    <span class="hljs-keyword">output</span> OF<br>    );<br>    <span class="hljs-comment">/* 定义各指令对应的操作 */</span><br>    <span class="hljs-keyword">parameter</span> ADD  = <span class="hljs-number">4&#x27;b0000</span>;<span class="hljs-comment">//有符号加</span><br>    <span class="hljs-keyword">parameter</span> ADDU = <span class="hljs-number">4&#x27;b0010</span>;<span class="hljs-comment">//无符号加</span><br>    <span class="hljs-keyword">parameter</span> SUB  = <span class="hljs-number">4&#x27;b0001</span>;<span class="hljs-comment">//有符号键</span><br>    <span class="hljs-keyword">parameter</span> SUBU = <span class="hljs-number">4&#x27;b0011</span>;<span class="hljs-comment">//无符号减</span><br>    <span class="hljs-keyword">parameter</span> AND  = <span class="hljs-number">4&#x27;b0100</span>;<span class="hljs-comment">//按位与</span><br>    <span class="hljs-keyword">parameter</span> OR   = <span class="hljs-number">4&#x27;b0101</span>;<span class="hljs-comment">//按位或</span><br>    <span class="hljs-keyword">parameter</span> XOR  = <span class="hljs-number">4&#x27;b0110</span>;<span class="hljs-comment">//按位异或</span><br>    <span class="hljs-keyword">parameter</span> NOR  = <span class="hljs-number">4&#x27;b0111</span>;<span class="hljs-comment">//安慰或非</span><br>    <span class="hljs-keyword">parameter</span> LUI  = <span class="hljs-number">4&#x27;b100x</span>;<span class="hljs-comment">//加载无符号立即数</span><br>    <span class="hljs-keyword">parameter</span> SLT  = <span class="hljs-number">4&#x27;b1011</span>;<span class="hljs-comment">//小于</span><br>    <span class="hljs-keyword">parameter</span> SLTU = <span class="hljs-number">4&#x27;b1010</span>;<span class="hljs-comment">//无符号小于</span><br>    <span class="hljs-keyword">parameter</span> SRA  = <span class="hljs-number">4&#x27;b1100</span>;<span class="hljs-comment">//算术右移</span><br>    <span class="hljs-keyword">parameter</span> SLL  = <span class="hljs-number">4&#x27;b111x</span>;<span class="hljs-comment">//逻辑右移</span><br>    <span class="hljs-keyword">parameter</span> SLA  = <span class="hljs-number">4&#x27;b111x</span>;<span class="hljs-comment">//算术左移</span><br>    <span class="hljs-keyword">parameter</span> SRL  = <span class="hljs-number">4&#x27;b1101</span>;<span class="hljs-comment">//逻辑左移</span><br>    <span class="hljs-comment">/* 定义一些内部用的变量 */</span><br>    <span class="hljs-keyword">reg</span> [<span class="hljs-number">32</span>:<span class="hljs-number">0</span>] result;          <span class="hljs-comment">//存储结果，result[32]为进位判断</span><br>    <span class="hljs-keyword">wire</span> <span class="hljs-keyword">signed</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] s_A,s_B; <span class="hljs-comment">//有符号数</span><br>    <span class="hljs-keyword">assign</span> s_A = A;<br>    <span class="hljs-keyword">assign</span> s_B = B;<br>    <br>    <span class="hljs-keyword">always</span> @(*)<br>    <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">case</span>(ALU_C)<br>            ADD:        <span class="hljs-keyword">begin</span> result &lt;= s_A + s_B;                      <span class="hljs-keyword">end</span> <br>            ADDU:       <span class="hljs-keyword">begin</span> result &lt;= A + B;                          <span class="hljs-keyword">end</span><br>            SUB:        <span class="hljs-keyword">begin</span> result &lt;= s_A - s_B;                      <span class="hljs-keyword">end</span><br>            SUBU:       <span class="hljs-keyword">begin</span> result &lt;= A - B;                          <span class="hljs-keyword">end</span><br>            AND:        <span class="hljs-keyword">begin</span> result &lt;= A &amp; B;                          <span class="hljs-keyword">end</span><br>            OR:         <span class="hljs-keyword">begin</span> result &lt;= A | B;                          <span class="hljs-keyword">end</span><br>            XOR:        <span class="hljs-keyword">begin</span> result &lt;= A ^ B;                          <span class="hljs-keyword">end</span><br>            NOR:        <span class="hljs-keyword">begin</span> result &lt;= ~(A | B);                       <span class="hljs-keyword">end</span><br>            LUI:        <span class="hljs-keyword">begin</span> result &lt;= &#123; B[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] , <span class="hljs-number">16&#x27;b0</span> &#125;;            <span class="hljs-keyword">end</span><br>            SLT:        <span class="hljs-keyword">begin</span> result &lt;= s_A - s_B;                      <span class="hljs-keyword">end</span><br>            SLTU:       <span class="hljs-keyword">begin</span> result &lt;= A - B;                          <span class="hljs-keyword">end</span><br>            SRA:        <span class="hljs-keyword">begin</span> result &lt;= s_B &gt;&gt;&gt; s_A;                    <span class="hljs-keyword">end</span><br>            SLL,SLA:    <span class="hljs-keyword">begin</span> result &lt;= B &lt;&lt; A;                         <span class="hljs-keyword">end</span><br>            SRL:        <span class="hljs-keyword">begin</span> result &lt;= B &gt;&gt; A;                         <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">endcase</span><br>    <span class="hljs-keyword">end</span> <br>    <br>    <span class="hljs-keyword">assign</span> OUT = result[<span class="hljs-number">31</span>:<span class="hljs-number">0</span>];              <span class="hljs-comment">//运算结果</span><br>    <span class="hljs-keyword">assign</span> CF =  result[<span class="hljs-number">32</span>];                <span class="hljs-comment">//进位标志位</span><br>    <span class="hljs-keyword">assign</span> ZF = (result == <span class="hljs-number">32&#x27;b0</span>) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;  <span class="hljs-comment">//0标志位</span><br>    <span class="hljs-keyword">assign</span> SF = (ALU_C == SLT ? (s_A &lt; s_B):<span class="hljs-comment">//有符号数比较</span><br>                 ((ALU_C == SLTU) ? (A &lt; B):<span class="hljs-comment">//无符号数比较</span><br>                                     <span class="hljs-number">1&#x27;b0</span>));<span class="hljs-comment">//0</span><br>    <span class="hljs-keyword">assign</span> OF = result[<span class="hljs-number">32</span>];                 <span class="hljs-comment">//溢出标志位</span><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="寄存器堆Regfile"><a href="#寄存器堆Regfile" class="headerlink" title="寄存器堆Regfile"></a>寄存器堆Regfile</h3><p>32位的寄存器堆</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 寄存器堆 */</span><br><span class="hljs-keyword">module</span> regfile(               <br>    <span class="hljs-keyword">input</span>  reg_clk,      <span class="hljs-comment">//时钟 </span><br>    <span class="hljs-keyword">input</span>  reg_ena,      <span class="hljs-comment">//使能     </span><br>    <span class="hljs-keyword">input</span>  rst_n,        <span class="hljs-comment">//清零     </span><br>    <span class="hljs-keyword">input</span>  reg_w,        <span class="hljs-comment">//写入</span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RdC,    <span class="hljs-comment">//目标寄存器</span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RtC,         <br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RsC,    <span class="hljs-comment">//源寄存器  </span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rd_data_in, <br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rs_data_out,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rt_data_out <br>);<br><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] array_reg [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>];<br><span class="hljs-keyword">assign</span> Rs_data_out = reg_ena ? array_reg[RsC] : <span class="hljs-number">32&#x27;bz</span>;<br><span class="hljs-keyword">assign</span> Rt_data_out = reg_ena ? array_reg[RtC] : <span class="hljs-number">32&#x27;bz</span>;<br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">negedge</span> reg_clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">posedge</span> rst_n)<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(rst_n &amp;&amp; reg_ena)<br>    <span class="hljs-keyword">begin</span><br>        array_reg[<span class="hljs-number">0</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">1</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">2</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">3</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">4</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">5</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">6</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">7</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">8</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">9</span>]  &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">10</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">11</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">12</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">13</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">14</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">15</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">16</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">17</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">18</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">19</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">20</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">21</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">22</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">23</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">24</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">25</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">26</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">27</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">28</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">29</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">30</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>        array_reg[<span class="hljs-number">31</span>] &lt;= <span class="hljs-number">32&#x27;h0</span>;<br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(reg_ena &amp;&amp; reg_w &amp;&amp; (RdC != <span class="hljs-number">5&#x27;h0</span>))<br>        array_reg[RdC] &lt;= Rd_data_in;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>

<h3 id="程序计数器PC"><a href="#程序计数器PC" class="headerlink" title="程序计数器PC"></a>程序计数器PC</h3><p>存储指令地址</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 程序计数器 */</span><br><span class="hljs-keyword">module</span> PC(                    <br>    <span class="hljs-keyword">input</span>  pc_clk,  <span class="hljs-comment">//时钟信号            </span><br>    <span class="hljs-keyword">input</span>  pc_ena,  <span class="hljs-comment">//使能信号            </span><br>    <span class="hljs-keyword">input</span>  rst_n,   <span class="hljs-comment">//重置信号            </span><br>    <span class="hljs-keyword">input</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_addr_in, <span class="hljs-comment">//读入指令地址</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_addr_out <span class="hljs-comment">//输出到IMEM</span><br>    );<br><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_reg = <span class="hljs-number">32&#x27;h00400000</span>;<span class="hljs-comment">//MARS地址初值</span><br><span class="hljs-keyword">assign</span> pc_addr_out = pc_ena ? pc_reg : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">negedge</span> pc_clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">posedge</span> rst_n)<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(rst_n &amp;&amp; pc_ena)<span class="hljs-keyword">begin</span><br>        pc_reg = <span class="hljs-number">32&#x27;h00400000</span>;<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pc_ena)<span class="hljs-keyword">begin</span><br>        pc_reg = pc_addr_in;<br>        <span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>负责调用PC，Controller等模块</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-keyword">module</span> cpu(<br>    <span class="hljs-keyword">input</span> clk,                  <span class="hljs-comment">//CPU执行时钟</span><br>    <span class="hljs-keyword">input</span> ena,                  <span class="hljs-comment">//使能信号端</span><br>    <span class="hljs-keyword">input</span> rst_n,                <span class="hljs-comment">//复位信号</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] instr_in,      <span class="hljs-comment">//当前要执行的指令</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_data,       <span class="hljs-comment">//读取到的DMEM的具体内容</span><br>    <span class="hljs-keyword">output</span> dm_ena,              <span class="hljs-comment">//是否需要启用DMEM</span><br>    <span class="hljs-keyword">output</span> dm_w,                <span class="hljs-comment">//如果启用DMEM，是否为写入</span><br>    <span class="hljs-keyword">output</span> dm_r,                <span class="hljs-comment">//如果启用DMEM，是否为读取</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_out,       <span class="hljs-comment">//输出指令地址，告诉IMEM要取哪条</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_addr,      <span class="hljs-comment">//启用DMEM的地址</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_data_w     <span class="hljs-comment">//要写入DMEM的内容 </span><br>    );<br><span class="hljs-comment">/* 定义一些内部变量 */</span><br><span class="hljs-comment">/* Decoder用 */</span><br><span class="hljs-keyword">wire</span> add_flag,  addu_flag, sub_flag, subu_flag, and_flag, or_flag, xor_flag, nor_flag,<br>     slt_flag,  sltu_flag,<br>     sll_flag,  srl_flag,  sra_flag, sllv_flag,<br>     srlv_flag, srav_flag,<br>     jr_flag,<br>     addi_flag, addiu_flag,<br>     andi_flag, ori_flag,  xori_flag,<br>     lw_flag,   sw_flag,<br>     beq_flag,  bne_flag,<br>     slti_flag, sltiu_flag,<br>     lui_flag,<br>     j_flag,    jal_flag;       <span class="hljs-comment">//各个指令的标志信息</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RsC;                 <span class="hljs-comment">//Rs对应的寄存器的地址</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RtC;                 <span class="hljs-comment">//Rt对应的寄存器的地址</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] RdC;                 <span class="hljs-comment">//Rd对应的寄存器的地址</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] shamt;               <span class="hljs-comment">//位移偏移量（SLL，SRL，SRA用）</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] immediate;          <span class="hljs-comment">//立即数（I型指令用）</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">25</span>:<span class="hljs-number">0</span>] address;            <span class="hljs-comment">//跳转地址（J型指令用）</span><br><br><span class="hljs-comment">/* Control用 */</span><br><span class="hljs-keyword">wire</span> reg_w;                     <span class="hljs-comment">//RegFile寄存器堆是否可写入</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] mux;                 <span class="hljs-comment">//9个多路选择器的状态</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] ext_ena;             <span class="hljs-comment">//EXT扩展是否开启，5个状态分别对应EXT1、EXT5、EXT16、EXT16(S)、EXT18(S),其中EXT[0]对应EXT1</span><br><span class="hljs-keyword">wire</span> cat_ena;                   <span class="hljs-comment">//是否需要拼接</span><br><br><span class="hljs-comment">/* ALU用 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] a, b;                              <span class="hljs-comment">//ALU的A、B运算输入端</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>]  aluc;                       <span class="hljs-comment">//ALUC四位运算指令</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] alu_data_out;               <span class="hljs-comment">//ALU输出的数据</span><br><span class="hljs-keyword">wire</span> zero, carry, negative, overflow;   <span class="hljs-comment">//四个标志位</span><br><br><span class="hljs-comment">/* 寄存器堆RegFile用 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rd_data_in;     <span class="hljs-comment">//要向寄存器中写入的值</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rs_data_out;    <span class="hljs-comment">//Rs对应的寄存器的输出值</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] Rt_data_out;    <span class="hljs-comment">//Rt对应的寄存器的输出值</span><br><br><span class="hljs-comment">/* PC寄存器用 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_addr_in;     <span class="hljs-comment">//本次输入PC寄存器的指令地址，也就是下一次要执行的指令</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_addr_out;    <span class="hljs-comment">//本次从PC寄存器中传出的指令地址，也就是当前需要执行的指令</span><br><br><span class="hljs-comment">/* 连接各模块 */</span><br><span class="hljs-comment">/* 符号、数据扩展器线路 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext1_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext5_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext16_out;<br><span class="hljs-keyword">wire</span> <span class="hljs-keyword">signed</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext16_out_signed;<br><span class="hljs-keyword">wire</span> <span class="hljs-keyword">signed</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext18_out_signed;<br><br><span class="hljs-keyword">assign</span> ext1_out         = (slt_flag  || sltu_flag) ? negative : (slti_flag || sltiu_flag) ? carry : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-keyword">assign</span> ext5_out         = (sll_flag  || srl_flag   || sra_flag ||sllv_flag||srlv_flag||srav_flag) ? mux10_out : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-keyword">assign</span> ext16_out        = (andi_flag || ori_flag   || xori_flag || lui_flag) ? &#123; <span class="hljs-number">16&#x27;h0</span> , immediate[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] &#125; : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-keyword">assign</span> ext16_out_signed = (addi_flag || addiu_flag || lw_flag || sw_flag || slti_flag || sltiu_flag) ?  &#123; &#123;<span class="hljs-number">16</span>&#123;immediate[<span class="hljs-number">15</span>]&#125;&#125; , immediate[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] &#125; : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-keyword">assign</span> ext18_out_signed = (beq_flag  || bne_flag) ? &#123;&#123;<span class="hljs-number">14</span>&#123;immediate[<span class="hljs-number">15</span>]&#125;&#125;, immediate[<span class="hljs-number">15</span>:<span class="hljs-number">0</span>], <span class="hljs-number">2&#x27;b0</span>&#125; : <span class="hljs-number">32&#x27;hz</span>;<br><span class="hljs-comment">//注意：Verilog不会显式地将无符号数变为有符号数，只有在运算时才会进行操作。因此我们不能通过赋值的方法完成从无符号数到有符号数的扩展，必须将符号位复制到高位</span><br><br><span class="hljs-comment">/* ||拼接器线路 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] cat_out;<br><br><span class="hljs-keyword">assign</span> cat_out = cat_ena ? &#123;pc_out[<span class="hljs-number">31</span>:<span class="hljs-number">28</span>], address[<span class="hljs-number">25</span>:<span class="hljs-number">0</span>], <span class="hljs-number">2&#x27;h0</span>&#125; : <span class="hljs-number">32&#x27;hz</span>;<br><br><span class="hljs-comment">/* NPC线路 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] npc;<br><span class="hljs-keyword">assign</span> npc = pc_addr_out + <span class="hljs-number">4</span>;<br><br><span class="hljs-comment">/* 多路选择器线路 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux1_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux2_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux3_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux4_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux5_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux6_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux7_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux8_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] mux9_out;<br><br><span class="hljs-keyword">assign</span> mux1_out = mux[<span class="hljs-number">1</span>] ? cat_out          : mux4_out;<br><span class="hljs-keyword">assign</span> mux2_out = mux[<span class="hljs-number">2</span>] ? mux9_out         : dm_data;<br><span class="hljs-keyword">assign</span> mux3_out = mux[<span class="hljs-number">3</span>] ? ext5_out         : Rs_data_out;<br><span class="hljs-keyword">assign</span> mux4_out = mux[<span class="hljs-number">4</span>] ? mux6_out         : Rs_data_out;<br><span class="hljs-keyword">assign</span> mux5_out = mux[<span class="hljs-number">5</span>] ? mux8_out         : Rt_data_out;<br><span class="hljs-keyword">assign</span> mux6_out = mux[<span class="hljs-number">6</span>] ? npc              : ext18_out_signed + npc;<br><span class="hljs-keyword">assign</span> mux7_out = mux[<span class="hljs-number">7</span>] ? pc_addr_out + <span class="hljs-number">4</span>  : mux2_out;<br><span class="hljs-keyword">assign</span> mux8_out = mux[<span class="hljs-number">8</span>] ? ext16_out_signed : ext16_out;<br><span class="hljs-keyword">assign</span> mux9_out = mux[<span class="hljs-number">9</span>] ? alu_data_out     : ext1_out;<br><span class="hljs-keyword">assign</span> mux10_out= mux[<span class="hljs-number">10</span>]? Rs_data_out[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>] : shamt;<br><br><span class="hljs-comment">/* PC线路 */</span><br><span class="hljs-keyword">assign</span> pc_addr_in = mux1_out;<br><br><span class="hljs-comment">/* ALU 接线口 */</span><br><span class="hljs-keyword">assign</span> a = mux3_out;<br><span class="hljs-keyword">assign</span> b = mux5_out;<br><br><span class="hljs-comment">/* IMEM接口 */</span><br><span class="hljs-keyword">assign</span> pc_out = pc_addr_out;<br><br><span class="hljs-comment">/* DMEM接口 */</span><br><span class="hljs-keyword">assign</span> dm_ena  = (dm_r || dm_w) ? <span class="hljs-number">1&#x27;b1</span> : <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">assign</span> dm_addr = alu_data_out;<br><span class="hljs-keyword">assign</span> dm_data_w = Rt_data_out;<br><br><span class="hljs-comment">/* 寄存器堆线路 */</span><br><span class="hljs-keyword">assign</span> Rd_data_in = mux7_out;<br><br><span class="hljs-comment">/* 实例化译码器 */</span><br>Decoder Decoder_inst(<br>    <span class="hljs-variable">.instr_in</span>(instr_in),        <span class="hljs-comment">//需要译码的指令，也就是当前要执行的指令</span><br>    <span class="hljs-variable">.add_flag</span>(add_flag),        <span class="hljs-comment">//指令是否为ADD</span><br>    <span class="hljs-variable">.addu_flag</span>(addu_flag),      <span class="hljs-comment">//指令是否为ADDU</span><br>    <span class="hljs-variable">.sub_flag</span>(sub_flag),        <span class="hljs-comment">//指令是否为SUB</span><br>    <span class="hljs-variable">.subu_flag</span>(subu_flag),      <span class="hljs-comment">//指令是否为SUBU</span><br>    <span class="hljs-variable">.and_flag</span>(and_flag),        <span class="hljs-comment">//指令是否为AND</span><br>    <span class="hljs-variable">.or_flag</span>(or_flag),          <span class="hljs-comment">//指令是否为OR</span><br>    <span class="hljs-variable">.xor_flag</span>(xor_flag),        <span class="hljs-comment">//指令是否为XOR</span><br>    <span class="hljs-variable">.nor_flag</span>(nor_flag),        <span class="hljs-comment">//指令是否为NOR</span><br>    <span class="hljs-variable">.slt_flag</span>(slt_flag),        <span class="hljs-comment">//指令是否为SLT</span><br>    <span class="hljs-variable">.sltu_flag</span>(sltu_flag),      <span class="hljs-comment">//指令是否为SLTU</span><br>    <span class="hljs-variable">.sll_flag</span>(sll_flag) ,       <span class="hljs-comment">//指令是否为SLL</span><br>    <span class="hljs-variable">.srl_flag</span>(srl_flag),        <span class="hljs-comment">//指令是否为SRL</span><br>    <span class="hljs-variable">.sra_flag</span>(sra_flag),        <span class="hljs-comment">//指令是否为SRA</span><br>    <span class="hljs-variable">.sllv_flag</span>(sllv_flag),      <span class="hljs-comment">//指令是否为SLLV</span><br>    <span class="hljs-variable">.srlv_flag</span>(srlv_flag),      <span class="hljs-comment">//指令是否为SRLV</span><br>    <span class="hljs-variable">.srav_flag</span>(srav_flag),      <span class="hljs-comment">//指令是否为SRAV</span><br>    <span class="hljs-variable">.jr_flag</span>(jr_flag),          <span class="hljs-comment">//指令是否为JR</span><br>    <span class="hljs-variable">.addi_flag</span>(addi_flag),      <span class="hljs-comment">//指令是否为ADDI</span><br>    <span class="hljs-variable">.addiu_flag</span>(addiu_flag),    <span class="hljs-comment">//指令是否为ADDIU</span><br>    <span class="hljs-variable">.andi_flag</span>(andi_flag),      <span class="hljs-comment">//指令是否为ANDI</span><br>    <span class="hljs-variable">.ori_flag</span>(ori_flag),        <span class="hljs-comment">//指令是否为ORI</span><br>    <span class="hljs-variable">.xori_flag</span>(xori_flag),      <span class="hljs-comment">//指令是否为XORI</span><br>    <span class="hljs-variable">.lw_flag</span>(lw_flag),          <span class="hljs-comment">//指令是否为LW</span><br>    <span class="hljs-variable">.sw_flag</span>(sw_flag),          <span class="hljs-comment">//指令是否为SW</span><br>    <span class="hljs-variable">.beq_flag</span>(beq_flag),        <span class="hljs-comment">//指令是否为BEQ</span><br>    <span class="hljs-variable">.bne_flag</span>(bne_flag),        <span class="hljs-comment">//指令是否为BNE</span><br>    <span class="hljs-variable">.slti_flag</span>(slti_flag),      <span class="hljs-comment">//指令是否为SLTI</span><br>    <span class="hljs-variable">.sltiu_flag</span>(sltiu_flag),    <span class="hljs-comment">//指令是否为SLTIU</span><br>    <span class="hljs-variable">.lui_flag</span>(lui_flag),        <span class="hljs-comment">//指令是否为LUI</span><br>    <span class="hljs-variable">.j_flag</span>(j_flag),            <span class="hljs-comment">//指令是否为J</span><br>    <span class="hljs-variable">.jal_flag</span>(jal_flag),        <span class="hljs-comment">//指令是否为JAL</span><br>    <span class="hljs-variable">.RsC</span>(RsC),                  <span class="hljs-comment">//Rs对应的寄存器的地址</span><br>    <span class="hljs-variable">.RtC</span>(RtC),                  <span class="hljs-comment">//Rt对应的寄存器的地址</span><br>    <span class="hljs-variable">.RdC</span>(RdC),                  <span class="hljs-comment">//Rd对应的寄存器的地址</span><br>    <span class="hljs-variable">.shamt</span>(shamt),              <span class="hljs-comment">//位移偏移量（SLL，SRL，SRA用）</span><br>    <span class="hljs-variable">.immediate</span>(immediate),      <span class="hljs-comment">//立即数（I型指令用）</span><br>    <span class="hljs-variable">.address</span>(address)           <span class="hljs-comment">//跳转地址（J型指令用）</span><br>    );<br><br><span class="hljs-comment">/* 实例化控制器 */</span><br>Controler Controler_inst(              <br>    <span class="hljs-variable">.add_flag</span>(add_flag),        <span class="hljs-comment">//指令是否为ADD</span><br>    <span class="hljs-variable">.addu_flag</span>(addu_flag),      <span class="hljs-comment">//指令是否为ADDU</span><br>    <span class="hljs-variable">.sub_flag</span>(sub_flag),        <span class="hljs-comment">//指令是否为SUB</span><br>    <span class="hljs-variable">.subu_flag</span>(subu_flag),      <span class="hljs-comment">//指令是否为SUBU</span><br>    <span class="hljs-variable">.and_flag</span>(and_flag),        <span class="hljs-comment">//指令是否为AND</span><br>    <span class="hljs-variable">.or_flag</span>(or_flag),          <span class="hljs-comment">//指令是否为OR</span><br>    <span class="hljs-variable">.xor_flag</span>(xor_flag),        <span class="hljs-comment">//指令是否为XOR</span><br>    <span class="hljs-variable">.nor_flag</span>(nor_flag),        <span class="hljs-comment">//指令是否为NOR</span><br>    <span class="hljs-variable">.slt_flag</span>(slt_flag),        <span class="hljs-comment">//指令是否为SLT</span><br>    <span class="hljs-variable">.sltu_flag</span>(sltu_flag),      <span class="hljs-comment">//指令是否为SLTU</span><br>    <span class="hljs-variable">.sll_flag</span>(sll_flag) ,       <span class="hljs-comment">//指令是否为SLL</span><br>    <span class="hljs-variable">.srl_flag</span>(srl_flag),        <span class="hljs-comment">//指令是否为SRL</span><br>    <span class="hljs-variable">.sra_flag</span>(sra_flag),        <span class="hljs-comment">//指令是否为SRA</span><br>    <span class="hljs-variable">.sllv_flag</span>(sllv_flag),      <span class="hljs-comment">//指令是否为SLLV</span><br>    <span class="hljs-variable">.srlv_flag</span>(srlv_flag),      <span class="hljs-comment">//指令是否为SRLV</span><br>    <span class="hljs-variable">.srav_flag</span>(srav_flag),      <span class="hljs-comment">//指令是否为SRAV</span><br>    <span class="hljs-variable">.jr_flag</span>(jr_flag),          <span class="hljs-comment">//指令是否为JR</span><br>    <span class="hljs-variable">.addi_flag</span>(addi_flag),      <span class="hljs-comment">//指令是否为ADDI</span><br>    <span class="hljs-variable">.addiu_flag</span>(addiu_flag),    <span class="hljs-comment">//指令是否为ADDIU</span><br>    <span class="hljs-variable">.andi_flag</span>(andi_flag),      <span class="hljs-comment">//指令是否为ANDI</span><br>    <span class="hljs-variable">.ori_flag</span>(ori_flag),        <span class="hljs-comment">//指令是否为ORI</span><br>    <span class="hljs-variable">.xori_flag</span>(xori_flag),      <span class="hljs-comment">//指令是否为XORI</span><br>    <span class="hljs-variable">.lw_flag</span>(lw_flag),          <span class="hljs-comment">//指令是否为LW</span><br>    <span class="hljs-variable">.sw_flag</span>(sw_flag),          <span class="hljs-comment">//指令是否为SW</span><br>    <span class="hljs-variable">.beq_flag</span>(beq_flag),        <span class="hljs-comment">//指令是否为BEQ</span><br>    <span class="hljs-variable">.bne_flag</span>(bne_flag),        <span class="hljs-comment">//指令是否为BNE</span><br>    <span class="hljs-variable">.slti_flag</span>(slti_flag),      <span class="hljs-comment">//指令是否为SLTI</span><br>    <span class="hljs-variable">.sltiu_flag</span>(sltiu_flag),    <span class="hljs-comment">//指令是否为SLTIU</span><br>    <span class="hljs-variable">.lui_flag</span>(lui_flag),        <span class="hljs-comment">//指令是否为LUI</span><br>    <span class="hljs-variable">.j_flag</span>(j_flag),            <span class="hljs-comment">//指令是否为J</span><br>    <span class="hljs-variable">.jal_flag</span>(jal_flag),        <span class="hljs-comment">//指令是否为JAL</span><br>    <span class="hljs-variable">.zero</span>(zero),                <span class="hljs-comment">//ALU标志位ZF</span><br>    <span class="hljs-variable">.reg_w</span>(reg_w),              <span class="hljs-comment">//RegFile寄存器堆是否可写入</span><br>    <span class="hljs-variable">.aluc</span>(aluc),                <span class="hljs-comment">//ALUC的指令，决定ALUC执行何种操作</span><br>    <span class="hljs-variable">.dm_r</span>(dm_r),                <span class="hljs-comment">//DMEM是否可写入</span><br>    <span class="hljs-variable">.dm_w</span>(dm_w),                <span class="hljs-comment">//是否从DMEM中读取数据</span><br>    <span class="hljs-variable">.ext_ena</span>(ext_ena),          <span class="hljs-comment">//EXT扩展是否开启，5个状态分别对应EXT1、EXT5、EXT16、EXT16(S)、EXT18(S),其中EXT[0]对应EXT1</span><br>    <span class="hljs-variable">.cat_ena</span>(cat_ena),          <span class="hljs-comment">//是否需要拼接</span><br>    <span class="hljs-variable">.mux</span>(mux)                   <span class="hljs-comment">//9个多路选择器的状态（选择0还是选择1）(0没用到，为了使MUX编号和数组下标对应所以多一个)</span><br>    );<br><br><span class="hljs-comment">/* 实例化ALU */</span><br>ALU ALU_inst(                      <br>    <span class="hljs-variable">.A</span>(a),                      <span class="hljs-comment">//对应A接口</span><br>    <span class="hljs-variable">.B</span>(b),                      <span class="hljs-comment">//对应B接口</span><br>    <span class="hljs-variable">.ALU_C</span>(aluc),                <span class="hljs-comment">//ALUC四位操作指令</span><br>    <span class="hljs-variable">.OUT</span>(alu_data_out),<span class="hljs-comment">//输出数据</span><br>    <span class="hljs-variable">.ZF</span>(zero),                <span class="hljs-comment">//ZF标志位，BEQ/BNE使用</span><br>    <span class="hljs-variable">.CF</span>(carry),              <span class="hljs-comment">//CF标志位，SLTI/SLTIU使用</span><br>    <span class="hljs-variable">.SF</span>(negative),        <span class="hljs-comment">//NF(SF)标志位，SLT/SLTU使用</span><br>    <span class="hljs-variable">.OF</span>(overflow)         <span class="hljs-comment">//OF标志位，其实没有用到</span><br>    );<br><br><span class="hljs-comment">/* 实例化寄存器堆 */</span><br>regfile cpu_ref(                <span class="hljs-comment">//寄存器堆RegFile，写入为同步，读取为异步</span><br>    <span class="hljs-variable">.reg_clk</span>(clk),              <span class="hljs-comment">//时钟信号，下降沿有效</span><br>    <span class="hljs-variable">.reg_ena</span>(ena),              <span class="hljs-comment">//使能信号端，上升沿有效</span><br>    <span class="hljs-variable">.rst_n</span>(rst_n),              <span class="hljs-comment">//复位信号，高电平有效（检测上升沿）</span><br>    <span class="hljs-variable">.reg_w</span>(reg_w),              <span class="hljs-comment">//写信号，高电平时寄存器可写入，低电平不可写入</span><br>    <span class="hljs-variable">.RdC</span>(RdC),                  <span class="hljs-comment">//Rd对应的寄存器的地址（写入端）</span><br>    <span class="hljs-variable">.RtC</span>(RtC),                  <span class="hljs-comment">//Rt对应的寄存器的地址（输出端）</span><br>    <span class="hljs-variable">.RsC</span>(RsC),                  <span class="hljs-comment">//Rs对应的寄存器的地址（输出端）</span><br>    <span class="hljs-variable">.Rd_data_in</span>(Rd_data_in),    <span class="hljs-comment">//要向寄存器中写入的值（需拉高reg_w）</span><br>    <span class="hljs-variable">.Rs_data_out</span>(Rs_data_out),  <span class="hljs-comment">//Rs对应的寄存器的输出值</span><br>    <span class="hljs-variable">.Rt_data_out</span>(Rt_data_out)   <span class="hljs-comment">//Rt对应的寄存器的输出值</span><br>    );<br><br><span class="hljs-comment">/* 实例化PC寄存器 */</span><br>PC PC_inst(                     <span class="hljs-comment">//指令地址寄存器</span><br>    <span class="hljs-variable">.pc_clk</span>(clk),               <span class="hljs-comment">//PC寄存器的时钟信号，写入为同步（时钟下降沿有效），读取为异步</span><br>    <span class="hljs-variable">.pc_ena</span>(ena),               <span class="hljs-comment">//使能端信号，高电平有效</span><br>    <span class="hljs-variable">.rst_n</span>(rst_n),              <span class="hljs-comment">//复位信号，高电平有效</span><br>    <span class="hljs-variable">.pc_addr_in</span>(pc_addr_in),    <span class="hljs-comment">//本次输入PC寄存器的指令地址，也就是下一次要执行的指令</span><br>    <span class="hljs-variable">.pc_addr_out</span>(pc_addr_out)   <span class="hljs-comment">//本次从PC寄存器中传出的指令地址，也就是当前需要执行的指令</span><br>    );<br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>

<h3 id="数据存储器DMEM"><a href="#数据存储器DMEM" class="headerlink" title="数据存储器DMEM"></a>数据存储器DMEM</h3><p>字长为32bit的数据存储器</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-comment">/* 数据存储器 */</span><br><span class="hljs-keyword">module</span> DMEM(<br>   <span class="hljs-keyword">input</span> D_clk,            <span class="hljs-comment">//时钟信号</span><br>   <span class="hljs-keyword">input</span> D_ena,            <span class="hljs-comment">//使能信号</span><br>   <span class="hljs-keyword">input</span> D_r,              <span class="hljs-comment">//读信号</span><br>   <span class="hljs-keyword">input</span> D_w,              <span class="hljs-comment">//写信号</span><br>   <span class="hljs-keyword">input</span> [<span class="hljs-number">10</span>:<span class="hljs-number">0</span>] D_addr,    <span class="hljs-comment">//地址</span><br>   <span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] D_data_in, <span class="hljs-comment">//数据输入</span><br>   <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] D_data_out<span class="hljs-comment">//数据输出</span><br>);<br><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dmem [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>];<span class="hljs-comment">//DMEM</span><br><br><span class="hljs-keyword">assign</span> D_data_out = (D_ena &amp;&amp; D_r &amp;&amp; !D_w) ? dmem[D_addr] : <span class="hljs-number">32&#x27;bz</span>;<span class="hljs-comment">//使能信号、读信号有效，写信号无效时才有输出，否则均为高阻态</span><br><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">negedge</span> D_clk)<br>    <span class="hljs-keyword">if</span>(D_ena &amp;&amp; D_w &amp;&amp;!D_r)<br>        dmem[D_addr]&lt;=D_data_in;<br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="指令存储器IMEM"><a href="#指令存储器IMEM" class="headerlink" title="指令存储器IMEM"></a>指令存储器IMEM</h3><p>字长为32bit的指令存储器</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-keyword">module</span> IMEM(<br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">10</span>:<span class="hljs-number">0</span>] I_addr_in,<br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] I_instr_out<br>    ); <br><br>dist_mem_gen_0 imem(<br>    <span class="hljs-variable">.a</span>(I_addr_in),<br>    <span class="hljs-variable">.spo</span>(I_instr_out)<br>    );<br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<h3 id="数据流sccomp-dataflow"><a href="#数据流sccomp-dataflow" class="headerlink" title="数据流sccomp_dataflow"></a>数据流sccomp_dataflow</h3><p>最顶层的文件，负责将指令存储器IMEM、数据存储器DMEM和CPU连接起来。</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-keyword">module</span> sccomp_dataflow(<br>    <span class="hljs-keyword">input</span> clk_in,       <span class="hljs-comment">//时钟信号</span><br>    <span class="hljs-keyword">input</span> reset,        <span class="hljs-comment">//复位信号</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] inst, <span class="hljs-comment">//输出指令</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc    <span class="hljs-comment">//执行地址</span><br>    );<br><br><span class="hljs-comment">/* CPU管脚 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] pc_out;          <span class="hljs-comment">//输出指令地址，告诉IMEM要取哪条</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_addr_temp;    <span class="hljs-comment">//DMEM临时地址，需要转化</span><br><br><br><span class="hljs-comment">/* IMEM管脚 */</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] im_addr_in;     <span class="hljs-comment">//11位指令码地址，从IMEM中读指令</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] im_instr_out;   <span class="hljs-comment">//32位指令码</span><br><br><span class="hljs-keyword">assign</span> im_addr_in = pc_out - <span class="hljs-number">32&#x27;h00400000</span>;<br><br><span class="hljs-comment">/* DMEM管脚 */</span><br><span class="hljs-keyword">wire</span> dm_ena;                <span class="hljs-comment">//是否需要启用DMEM</span><br><span class="hljs-keyword">wire</span> dm_r, dm_w;            <span class="hljs-comment">//读写指令</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_addr;        <span class="hljs-comment">//需要用到的DMEM地址</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_data_out;    <span class="hljs-comment">//DMEM读取时读取到的数据</span><br><span class="hljs-keyword">wire</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dm_data_w;      <span class="hljs-comment">//要写入DMEM的内容 </span><br><br><span class="hljs-keyword">assign</span> dm_addr = (dm_addr_temp -  <span class="hljs-number">32&#x27;h10010000</span>)/<span class="hljs-number">4</span>;<br><br><span class="hljs-comment">/* 输出管脚 */</span><br><span class="hljs-keyword">assign</span> pc = pc_out;<br><span class="hljs-keyword">assign</span> inst = im_instr_out;<br><br><br><span class="hljs-comment">/* 指令存储器实例化 */</span><br>IMEM imem(<br>    <span class="hljs-variable">.I_addr_in</span>(im_addr_in[<span class="hljs-number">12</span>:<span class="hljs-number">2</span>]),  <span class="hljs-comment">//11位指令码地址，从IMEM中读指令</span><br>    <span class="hljs-variable">.I_instr_out</span>(im_instr_out)     <span class="hljs-comment">//32位指令码</span><br>    );<br><br><span class="hljs-comment">/* 数据存储器实例化 */</span><br>DMEM dmem(                      <span class="hljs-comment">//DMEM根据性能考量，设计成异步读取数据，同步写入数据的形式</span><br>    <span class="hljs-variable">.D_clk</span>(clk_in),            <span class="hljs-comment">//DMEM时钟信号，只在写数据时使用</span><br>    <span class="hljs-variable">.D_ena</span>(dm_ena),            <span class="hljs-comment">//使能信号端，高电平有效，有效时才能读取/写入数据</span><br>    <span class="hljs-variable">.D_r</span>(dm_r),                <span class="hljs-comment">//read读信号，读取时拉高</span><br>    <span class="hljs-variable">.D_w</span>(dm_w),                <span class="hljs-comment">//write写信号，写入时拉高</span><br>    <span class="hljs-variable">.D_addr</span>(dm_addr[<span class="hljs-number">10</span>:<span class="hljs-number">0</span>]),    <span class="hljs-comment">//11位地址，要读取/写入的地址</span><br>    <span class="hljs-variable">.D_data_in</span>(dm_data_w),     <span class="hljs-comment">//写入时要写入的数据</span><br>    <span class="hljs-variable">.D_data_out</span>(dm_data_out)   <span class="hljs-comment">//读取时读取到的数据</span><br>    );<br><br><span class="hljs-comment">/* CPU实例化 */</span><br>cpu sccpu(<br>    <span class="hljs-variable">.clk</span>(clk_in),               <span class="hljs-comment">//CPU执行时钟</span><br>    <span class="hljs-variable">.ena</span>(<span class="hljs-number">1&#x27;b1</span>),                 <span class="hljs-comment">//使能信号端</span><br>    <span class="hljs-variable">.rst_n</span>(reset),              <span class="hljs-comment">//复位信号</span><br>    <span class="hljs-variable">.instr_in</span>(im_instr_out),    <span class="hljs-comment">//当前要执行的指令</span><br>    <span class="hljs-variable">.dm_data</span>(dm_data_out),      <span class="hljs-comment">//读取到的DMEM的具体内容</span><br>    <span class="hljs-variable">.dm_ena</span>(dm_ena),            <span class="hljs-comment">//是否需要启用DMEM</span><br>    <span class="hljs-variable">.dm_w</span>(dm_w),                <span class="hljs-comment">//如果启用DMEM，是否为写入</span><br>    <span class="hljs-variable">.dm_r</span>(dm_r),                <span class="hljs-comment">//如果启用DMEM，是否为读取</span><br>    <span class="hljs-variable">.pc_out</span>(pc_out),            <span class="hljs-comment">//输出指令地址，告诉IMEM要取哪条</span><br>    <span class="hljs-variable">.dm_addr</span>(dm_addr_temp),     <span class="hljs-comment">//需要用到的DMEM地址</span><br>    <span class="hljs-variable">.dm_data_w</span>(dm_data_w)       <span class="hljs-comment">//要写入DMEM的内容 </span><br>    );<br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>

<p>注意：指令存储器的实现用到了IP核。</p>
<h3 id="如何生成IP核："><a href="#如何生成IP核：" class="headerlink" title="如何生成IP核："></a>如何生成IP核：</h3><p><img src="/Ylr9933/../img/CPU31-image-65.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>参数配置如下：<br><img src="/Ylr9933/../img/CPU31-image-66.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br><img src="/Ylr9933/../img/CPU31-image-67.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br><img src="/Ylr9933/../img/CPU31-image-68.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>注：此处的Coefficients File使用的是coe文件，也就是存储CPU运行的程序的文件。</p>
<h3 id="如何获取-coe文件："><a href="#如何获取-coe文件：" class="headerlink" title="如何获取.coe文件："></a>如何获取.coe文件：</h3><p>在Mars中编写你想要测试的汇编代码，选择assemble指令进行编译<br><img src="/Ylr9933/../img/CPU31-image-69.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>跳转到execude界面<br><img src="/Ylr9933/../img/CPU31-image-70.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>之后将文件以16进制导出<br><img src="/Ylr9933/../img/CPU31-image-71.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br><img src="/Ylr9933/../img/CPU31-image-72.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"><br>将文件名后缀改为.coe,之后就能将该coe文件导入IP核了。<br><img src="/Ylr9933/../img/CPU31-image-73.png" srcset="/Ylr9933/img/loading.gif" lazyload alt="alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asm"># 示例：addi指令的测试代码<br>sll $0,$0,0<br>addi $0,$0,0xffffffff<br>addi $1,$0,0x0001<br>addi $2,$0,0xffff8000<br>addi $3,$0,0x7fff<br>addi $4,$1,0xffffffff<br>addi $5,$2,0xffffffff<br>addi $6,$3,0x0006<br></code></pre></td></tr></table></figure>

<p>至此，我们的CPU就能正常运行代码啦，不过需要运行的代码都需要通过以上这种形式转为coe文件导入IP核才能运行</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>31指令CPU</div>
      <div>https://github.com/Ylr9933/2024/07/26/CPU31/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>YLR</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年7月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Ylr9933/2024/07/26/dp/" title="动态规划">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">动态规划</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/Ylr9933/js/events.js" ></script>
<script  src="/Ylr9933/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/Ylr9933/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/Ylr9933/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/Ylr9933/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
